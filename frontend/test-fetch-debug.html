<!DOCTYPE html>
<html>
<head>
  <title>Fetch Debug Test</title>
</head>
<body>
  <h1>OpenAI Fetch Debug</h1>
  <p>Open browser console (F12) to see results</p>

  <button onclick="testFetch()">Test OpenAI API</button>
  <div id="result" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>

  <script>
    async function testFetch() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = 'Testing...';

      const API_KEY = prompt('Enter your OpenAI API key:');
      if (!API_KEY) {
        resultDiv.innerHTML = '❌ No API key provided';
        return;
      }

      console.log('[Test] Making fetch request to OpenAI API...');
      console.log('[Test] API Key (first 10 chars):', API_KEY.substring(0, 10));

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: 'gpt-4o-2024-11-20',
            messages: [
              { role: 'system', content: 'You are a test assistant. Output ONLY valid JSON.' },
              { role: 'user', content: 'Return JSON: {"test": "success"}' }
            ],
            temperature: 0.7,
            max_tokens: 100,
            response_format: { type: 'json_object' }
          })
        });

        console.log('[Test] Response status:', response.status);
        console.log('[Test] Response ok:', response.ok);

        if (!response.ok) {
          const errorData = await response.json();
          console.error('[Test] Error data:', errorData);
          resultDiv.innerHTML = `❌ API Error: ${errorData.error?.message || response.status}`;
          return;
        }

        const data = await response.json();
        console.log('[Test] Success! Response:', data);
        resultDiv.innerHTML = `✅ Success! Generated text: ${data.choices[0].message.content}`;

      } catch (error) {
        console.error('[Test] Fetch error:', error);
        console.error('[Test] Error type:', error.constructor.name);
        console.error('[Test] Error message:', error.message);
        resultDiv.innerHTML = `❌ Fetch Error: ${error.message}<br><br>This could be:<br>- Network issue<br>- CORS problem<br>- Invalid API key format`;
      }
    }
  </script>
</body>
</html>
